<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullscreen Video Test</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }
        #video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .control-button {
            position: fixed;
            z-index: 10000;
            background-color: #444;
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        .fullscreen-button {
            bottom: 10px;
            right: 10px;
        }
        .close-button {
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <iframe id="hihaho-video" src="https://player.hihaho.com/embed/de97a16f-1b37-49bd-bc9b-500b083ae64e?api=true" allow="autoplay; fullscreen; clipboard-read; clipboard-write" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true"></iframe>
    </div>
    <button class="control-button fullscreen-button" onclick="toggleFullscreen()">Fullscreen</button>
    <button class="control-button close-button" onclick="closeTab()">Close</button>

    <script>
        const videoContainer = document.getElementById('video-container');
        const iframe = document.getElementById('hihaho-video');

        // Function to toggle fullscreen mode
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                enterFullScreen();
            } else {
                exitFullScreen();
            }
        }

        // Function to simulate entering full screen
        function enterFullScreen() {
            if (videoContainer.requestFullscreen) {
                videoContainer.requestFullscreen();
            } else if (videoContainer.mozRequestFullScreen) { /* Firefox */
                videoContainer.mozRequestFullScreen();
            } else if (videoContainer.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                videoContainer.webkitRequestFullscreen();
            } else if (videoContainer.msRequestFullscreen) { /* IE/Edge */
                videoContainer.msRequestFullscreen();
            }
        }

        // Function to simulate exiting full screen
        function exitFullScreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) { /* Firefox */
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE/Edge */
                document.msExitFullscreen();
            }
        }

        // Function to close the tab
        function closeTab() {
            window.close();
        }

        // Automatically enter fullscreen when the page loads
        window.onload = function() {
            enterFullScreen();
        }

        // Event listener for messages from the iframe
        window.addEventListener('message', (event) => {
            const data = event.data;

            // Check if the hihaho player is ready
            if (data.type === 'documentTrigger' && data.triggerName === 'hihaho_ready') {
                if (!data.triggerData.supportsFullscreen) {
                    // Send a message to enable custom fullscreen handling
                    iframe.contentWindow.postMessage({ type: 'api_fullscreen_event' }, '*');
                }
            }
            // Check for enter fullscreen event
            else if (data.type === 'documentTrigger' && data.triggerName === 'hihaho_enter_fullscreen') {
                enterFullScreen();
            }
            // Check for exit fullscreen event
            else if (data.type === 'documentTrigger' && data.triggerName === 'hihaho_exit_fullscreen') {
                exitFullScreen();
            }
        }, false);

        // Handle orientation changes to ensure the video remains responsive
        window.addEventListener('orientationchange', () => {
            adjustVideoSize();
        });

        // Adjust video size to maintain aspect ratio
        function adjustVideoSize() {
            const aspectRatio = 16 / 9;
            const windowHeight = window.innerHeight;
            const windowWidth = window.innerWidth;
            if (windowWidth / windowHeight > aspectRatio) {
                iframe.style.width = windowHeight * aspectRatio + 'px';
                iframe.style.height = windowHeight + 'px';
            } else {
                iframe.style.width = windowWidth + 'px';
                iframe.style.height = windowWidth / aspectRatio + 'px';
            }
        }

        // Initial adjustment
        adjustVideoSize();
    </script>
</body>
</html>
